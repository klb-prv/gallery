---
import { Image } from "astro:assets";
import Modal from "./Modal.astro";

interface Props {
  imgSrc: string;
  source: string;
  allImages: string[]; // lista ścieżek do zdjęć
}
const { imgSrc, source } = Astro.props;
const allImages: string[] = Astro.props.allImages ?? [imgSrc]; // DOMYŚLNA TABLICA

const images =
  source === "default"
    ? import.meta.glob<{ default: any }>("../thumbnails/*")
    : import.meta.glob<{ default: any }>("../thumbnails/other/*");

let currentIndex = allImages.indexOf(imgSrc);
if (currentIndex === -1) currentIndex = 0;

const getImage = async (path: string) => {
  const imageModule = await images[path]();
  return imageModule.default;
};

let selectedImage = await getImage(allImages[currentIndex]);


// Helper do aktualizacji indexu i zdjęcia w modalu
const updateImage = async (newIndex: number) => {
  if (newIndex < 0) newIndex = allImages.length - 1;
  if (newIndex >= allImages.length) newIndex = 0;
  currentIndex = newIndex;
  selectedImage = await getImage(allImages[currentIndex]);
  const modal = document.getElementById(uniqueId);
  if (modal) {
    // Znajdź obrazek i podmień src
    const img = modal.querySelector("img");
    if (img) {
      img.src = selectedImage.src;
    }
  }
};

const uniqueId = `image-preview-${crypto.randomUUID()}`;

---

<div
  class="w-[450px] h-[250px] my-4 rounded-lg flex justify-center items-center text-3xl cursor-pointer hover:drop-shadow-2xl hover:border-2 hover:border-white transition"
  style="transition: all .1s ease-in-out;"
  onclick={`document.getElementById('${uniqueId}').showModal()`}
>
  <Image
    class="w-[445px] h-[245px] rounded-lg"
    src={selectedImage}
    alt="Picture"
    width="1280"
    format="webp"
  />
</div>

<Modal
  id={uniqueId}
  onClose={() => document.getElementById(uniqueId).close()}
  onPrev={() => {
    updateImage(currentIndex - 1);
  }}
  onNext={() => {
    updateImage(currentIndex + 1);
  }}
>
  <Image
    slot="main"
    class="rounded-lg"
    src={selectedImage}
    alt="Picture"
    width="1280"
    format="webp"
  />
</Modal>
